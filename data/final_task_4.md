# Итоговое задание №4

### [Назад в Содержание ⤶](/README.md)

## Задача
Необходимо провести анализ логов на сервере. Решить задачу, используя только **Bash** и **Linux**.  
В качестве ответа приложите ссылку на **git**.  
В репозитории должны находиться:
1. Файл ***analyze_logs.sh*** с кодом на языке **bash**.  
2. Файл, который получился при выполнении ***analyze_logs.sh***  
3. Cкриншот, где отчетливо видно, что скрипт запускается, скрипт сделался исполняемым и команда **cat** к файлу 
***report.txt*** работает.  

### Входные данные
Файл *[access.log](task_4/access.log)* с логами следующего содержания:

```txt
192.168.1.1 - - [28/Jul/2024:12:34:56 +0000] "GET /index.html HTTP/1.1" 200 1234
192.168.1.2 - - [28/Jul/2024:12:35:56 +0000] "POST /login HTTP/1.1" 200 567
192.168.1.3 - - [28/Jul/2024:12:36:56 +0000] "GET /home HTTP/1.1" 404 890
192.168.1.1 - - [28/Jul/2024:12:37:56 +0000] "GET /index.html HTTP/1.1" 200 1234
192.168.1.4 - - [28/Jul/2024:12:38:56 +0000] "GET /about HTTP/1.1" 200 432
192.168.1.2 - - [28/Jul/2024:12:39:56 +0000] "GET /index.html HTTP/1.1" 200 1234
```

## Решение задачи
Начинаем писать скрипт.

### Установка кодировки
Чтобы минимизировать проблемы с выводом, установим кодировку отчета, добавив следующую строку в скрипт:

```bash
export LANG=ru_RU.UTF-8
```

### Файл с логами
Подключаем исходный файл с логами:

```bash
LOG_FILE="access.log"
```

### Подсчет общего количества запросов
Считаем количество запросов в лог-файле:

```bash
total_requests=$(awk 'NF' "$LOG_FILE" | wc -l)
```

### Подсчет уникальных IP-адресов
Считаем количество уникальных адресов:

```bash
unique_ips=$(awk '{print $1}' "$LOG_FILE" | sort -u | wc -l)
```

### Подсчет количества запросов по методам
Считаем количество каждого метода и удаляем кавчки (в логе метод начинается со знака `"`):

```bash
method_counts=$(awk '{gsub(/"/, ""); print $6}' "$LOG_FILE" | sort | uniq -c)
```

### Найти самый популярный URL
URL, который чаще други встречается в логах:

```bash
popular_url=$(awk '{print $7}' "$LOG_FILE" | sort | uniq -c | sort -nr | head -n 1)
```

### Создание отчета
Отчет, это то, что будет выведено в консоль:

```bash
{
  echo "Отчет о логе вебсервера"
  echo "======================="
  echo "Общее количество запросов: $total_requests"
  echo "Количество уникальных IP-адресов: $unique_ips"
  echo ""
  echo "Количество запросов по методам:"
  echo "$method_counts"
  echo ""
  echo "Самый популярный URL: $popular_url"
} > report.txt
```

### Сборка скрипта
Собираем все в один файл `analyze_logs.sh`, не забывая вначале добавить строчку:

```bash
#!/bin/bash
```

Также, в конце скрипта, можно добавить фразу, которая оповестит нас об успешной отработке скрипта:

```bash
echo "Отчет создан в report.txt"
```

### Запуск скрипта
Сначала сделаем скрипт исполняемым:

```bash
chmod +x analyze_logs.sh
```

Теперь запустим скрипт:

```bash
./analyze_logs.sh
```

### Проверка отчета

```bash
cat report.txt
```

Видим вывод:

<img src="/img/task_4.png" width="40%">